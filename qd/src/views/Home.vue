<template>
  <div class="home-page">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <Header 
      title="æ¬¢è¿ä½¿ç”¨Vue3å‰ç«¯åº”ç”¨" 
      subtitle="ç°ä»£åŒ–çš„Vue3åº”ç”¨æ¨¡æ¿ï¼Œå±•ç¤ºç»„ä»¶åŒ–æ¶æ„ã€å“åº”å¼æ•°æ®å’Œäº¤äº’åŠŸèƒ½"
    />

    <!-- åŠŸèƒ½æ¼”ç¤ºåŒºåŸŸ -->
    <section class="demo-section">
      <div class="demo-grid">
        <!-- åŸºç¡€è®¡æ•°å™¨æ¼”ç¤º -->
        <Card title="åŸºç¡€è®¡æ•°å™¨" :shadow="true">
          <template #default>
            <p class="card-description">æ¼”ç¤ºVue3çš„å“åº”å¼æ•°æ®ç»‘å®šå’ŒComposition API</p>
            <Counter 
              label="ç‚¹å‡»æŒ‰é’®æ”¹å˜æ•°å€¼"
              :initial-value="0"
              :show-info="true"
              :show-double="true"
              @update="handleCounterUpdate"
            />
          </template>
        </Card>

        <!-- å¸¦é™åˆ¶çš„è®¡æ•°å™¨ -->
        <Card title="å¸¦é™åˆ¶çš„è®¡æ•°å™¨" :shadow="true">
          <template #default>
            <p class="card-description">æ¼”ç¤ºå¸¦æœ€å°å€¼å’Œæœ€å¤§å€¼é™åˆ¶çš„è®¡æ•°å™¨</p>
            <Counter 
              label="èŒƒå›´: 0-10"
              :initial-value="5"
              :min="0"
              :max="10"
              :bounded="true"
              :show-step-controls="true"
              :show-quick-actions="false"
            />
          </template>
        </Card>

        <!-- ä¸»é¢˜åˆ‡æ¢æ¼”ç¤º -->
        <Card title="ä¸»é¢˜ç®¡ç†" :shadow="true">
          <template #default>
            <p class="card-description">
              å½“å‰ä¸»é¢˜: <strong class="theme-indicator">{{ themeDisplayName }}</strong>
            </p>
            <div class="theme-controls">
              <Button 
                type="primary" 
                size="medium"
                @click="toggleTheme"
              >
                {{ themeButtonText }}
              </Button>
              <div class="theme-info">
                <span class="theme-status">{{ themeStatus }}</span>
              </div>
            </div>
          </template>
        </Card>

        <!-- Vue3ç‰¹æ€§å±•ç¤º -->
        <Card title="Vue3 æ ¸å¿ƒç‰¹æ€§" :shadow="true">
          <template #default>
            <p class="card-description">æœ¬åº”ç”¨å±•ç¤ºçš„Vue3ç°ä»£å¼€å‘ç‰¹æ€§</p>
            <div class="feature-grid">
              <div class="feature-item">
                <span class="feature-icon">âš¡</span>
                <div class="feature-content">
                  <h4>Composition API</h4>
                  <p>æ›´å¥½çš„é€»è¾‘å¤ç”¨å’Œä»£ç ç»„ç»‡</p>
                </div>
              </div>
              <div class="feature-item">
                <span class="feature-icon">ğŸ”„</span>
                <div class="feature-content">
                  <h4>å“åº”å¼ç³»ç»Ÿ</h4>
                  <p>é«˜æ•ˆçš„æ•°æ®ç»‘å®šå’Œæ›´æ–°</p>
                </div>
              </div>
              <div class="feature-item">
                <span class="feature-icon">ğŸ§©</span>
                <div class="feature-content">
                  <h4>ç»„ä»¶åŒ–æ¶æ„</h4>
                  <p>å¯é‡ç”¨çš„UIç»„ä»¶è®¾è®¡</p>
                </div>
              </div>
              <div class="feature-item">
                <span class="feature-icon">ğŸ¨</span>
                <div class="feature-content">
                  <h4>ä¸»é¢˜ç³»ç»Ÿ</h4>
                  <p>æ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢</p>
                </div>
              </div>
            </div>
          </template>
          <template #actions>
            <Button type="secondary" size="small" @click="showMoreFeatures">
              äº†è§£æ›´å¤š
            </Button>
          </template>
        </Card>

        <!-- äº¤äº’ç»Ÿè®¡ -->
        <Card title="äº¤äº’ç»Ÿè®¡" :shadow="true">
          <template #default>
            <p class="card-description">è®°å½•ç”¨æˆ·åœ¨å½“å‰ä¼šè¯ä¸­çš„äº¤äº’æ¬¡æ•°</p>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-number">{{ stats.counterClicks }}</span>
                <span class="stat-label">è®¡æ•°å™¨ç‚¹å‡»</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ stats.themeToggles }}</span>
                <span class="stat-label">ä¸»é¢˜åˆ‡æ¢</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ stats.pageViews }}</span>
                <span class="stat-label">é¡µé¢è®¿é—®</span>
              </div>
            </div>
          </template>
          <template #actions>
            <Button type="danger" size="small" @click="resetStats">
              é‡ç½®ç»Ÿè®¡
            </Button>
          </template>
        </Card>
      </div>
    </section>
  </div>
</template>

<script>
import { ref, computed, onMounted, watch } from 'vue'
import { useTheme } from '../composables/useTheme.js'
import Header from '../components/common/Header.vue'
import Card from '../components/ui/Card.vue'
import Counter from '../components/ui/Counter.vue'
import Button from '../components/ui/Button.vue'

export default {
  name: 'Home',
  components: {
    Header,
    Card,
    Counter,
    Button
  },
  setup() {
    // ä½¿ç”¨ä¸»é¢˜ç®¡ç†
    const { theme, isDark, toggleTheme, initTheme } = useTheme()

    // äº¤äº’ç»Ÿè®¡
    const stats = ref({
      counterClicks: 0,
      themeToggles: 0,
      pageViews: 1
    })

    // è®¡ç®—å±æ€§
    const themeDisplayName = computed(() => {
      return isDark.value ? 'æš—è‰²ä¸»é¢˜' : 'æ˜äº®ä¸»é¢˜'
    })

    const themeButtonText = computed(() => {
      return `åˆ‡æ¢åˆ°${isDark.value ? 'æ˜äº®' : 'æš—è‰²'}ä¸»é¢˜`
    })

    const themeStatus = computed(() => {
      return isDark.value ? 'ğŸŒ™ å¤œé—´æ¨¡å¼å·²å¯ç”¨' : 'â˜€ï¸ æ—¥é—´æ¨¡å¼å·²å¯ç”¨'
    })

    // æ–¹æ³•
    const handleCounterUpdate = (value) => {
      stats.value.counterClicks++
    }

    const handleThemeToggle = () => {
      toggleTheme()
      stats.value.themeToggles++
    }

    const showMoreFeatures = () => {
      // è¿™é‡Œå¯ä»¥å¯¼èˆªåˆ°å…³äºé¡µé¢æˆ–æ˜¾ç¤ºæ›´å¤šä¿¡æ¯
      alert('æ›´å¤šç‰¹æ€§è¯·æŸ¥çœ‹å…³äºé¡µé¢ï¼')
    }

    const resetStats = () => {
      stats.value = {
        counterClicks: 0,
        themeToggles: 0,
        pageViews: stats.value.pageViews
      }
    }

    // ç”Ÿå‘½å‘¨æœŸ
    onMounted(() => {
      initTheme()
      
      // ä»localStorageæ¢å¤ç»Ÿè®¡æ•°æ®
      const savedStats = localStorage.getItem('home-stats')
      if (savedStats) {
        try {
          const parsed = JSON.parse(savedStats)
          stats.value = {
            ...parsed,
            pageViews: parsed.pageViews + 1
          }
        } catch (error) {
          console.warn('æ— æ³•æ¢å¤ç»Ÿè®¡æ•°æ®:', error)
        }
      }

      // ç›‘å¬ç»Ÿè®¡å˜åŒ–å¹¶ä¿å­˜
      const saveStats = () => {
        localStorage.setItem('home-stats', JSON.stringify(stats.value))
      }

      // ä½¿ç”¨watchç›‘å¬statså˜åŒ–
      watch(stats, saveStats, { deep: true })
    })

    return {
      // ä¸»é¢˜ç›¸å…³
      theme,
      isDark,
      themeDisplayName,
      themeButtonText,
      themeStatus,
      toggleTheme: handleThemeToggle,
      
      // ç»Ÿè®¡æ•°æ®
      stats,
      
      // æ–¹æ³•
      handleCounterUpdate,
      showMoreFeatures,
      resetStats
    }
  }
}
</script>

<style scoped>
.home-page {
  min-height: 100vh;
}

/* æ¼”ç¤ºåŒºåŸŸ */
.demo-section {
  padding: var(--spacing-2xl) 0;
}

.demo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: var(--spacing-xl);
}

/* å¡ç‰‡å†…å®¹æ ·å¼ */
.card-description {
  color: var(--color-text-secondary);
  margin-bottom: var(--spacing-lg);
  line-height: 1.6;
  font-size: var(--font-size-sm);
}

/* ä¸»é¢˜æ§åˆ¶æ ·å¼ */
.theme-controls {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  align-items: center;
}

.theme-indicator {
  color: var(--color-primary);
  font-weight: 600;
}

.theme-info {
  text-align: center;
}

.theme-status {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  padding: var(--spacing-xs) var(--spacing-sm);
  background-color: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
}

/* ç‰¹æ€§ç½‘æ ¼æ ·å¼ */
.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-md);
  margin-top: var(--spacing-md);
}

.feature-item {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-radius: var(--border-radius-md);
  transition: background-color var(--transition-fast);
}

.feature-item:hover {
  background-color: var(--color-bg-tertiary);
}

.feature-icon {
  font-size: var(--font-size-xl);
  flex-shrink: 0;
  margin-top: var(--spacing-xs);
}

.feature-content h4 {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-primary);
}

.feature-content p {
  margin: 0;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  line-height: 1.4;
}

/* ç»Ÿè®¡ç½‘æ ¼æ ·å¼ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--spacing-md);
  margin-top: var(--spacing-md);
}

.stat-item {
  text-align: center;
  padding: var(--spacing-md);
  background-color: var(--color-bg-tertiary);
  border-radius: var(--border-radius-md);
  transition: all var(--transition-fast);
}

.stat-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}

.stat-number {
  display: block;
  font-size: var(--font-size-2xl);
  font-weight: 700;
  color: var(--color-primary);
  margin-bottom: var(--spacing-xs);
}

.stat-label {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .demo-grid {
    grid-template-columns: 1fr;
    gap: var(--spacing-lg);
  }
  
  .feature-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
    gap: var(--spacing-sm);
  }
  
  .feature-item {
    padding: var(--spacing-xs);
  }
}

@media (max-width: 480px) {
  .demo-section {
    padding: var(--spacing-xl) 0;
  }
  
  .theme-controls {
    gap: var(--spacing-sm);
  }
  
  .stat-item {
    padding: var(--spacing-sm);
  }
  
  .stat-number {
    font-size: var(--font-size-xl);
  }
}
</style>